<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" ><topic xml:lang="en-us" id="windows_troubleshooting">
  <title>HPE Helion Development Platform 2.0: Windows Troubleshooting</title>
  <titlealts>
    <searchtitle>HPE Helion 2.0 Development Platform: Windows Troubleshooting</searchtitle>
  </titlealts>
  <prolog>
    <metadata>
      <othermeta name="layout" content="default"/>
      <othermeta name="product-version" content="HPE Helion Development Platform"/>
      <othermeta name="product-version" content="HPE Helion Development Platform 2.0"/>
      <othermeta name="role" content="Systems Administrator"/>
      <othermeta name="role" content="System Engineer"/>
      <othermeta name="role" content="Cloud Administrator"/>
      <othermeta name="role" content="Network Administrator"/>
      <othermeta name="role" content="Application Developer"/>
      <othermeta name="role" content="Application Developer"/>
      <othermeta name="role" content="ISV Developer"/>
      <othermeta name="role" content="Service Developer"/>
      <othermeta name="role" content="Patrick F"/>
    </metadata>
  </prolog>
  <body>
    <section><ph>
      <i>Windows, .NET, SQL Server, and IIS are either registered trademarks or trademarks of Microsoft Corporation in the United States and/or other countries.</i>
    </ph></section>
    <p>This document describes troubleshooting and additional configuration steps for Windows instances.</p>
    <p>This document contains the following sections:</p>
    <ul>
      <li><xref href="#windows_troubleshooting/kato_upstream_proxies">Upstream proxies are not set in DEAs added after cluster creation</xref></li>
      <li><xref href="#windows_troubleshooting/kato_patch">Kato tries to install patches on Windows nodes</xref></li>
      <li><xref href="#windows_troubleshooting/instances">Windows instances created from the Images page in Horizon do not work</xref></li>
      <li><xref href="#windows_troubleshooting/broker">Error: Unable to attach broker to cluster: Received a status code 504 Gateway Time-out</xref></li>
    </ul>
    <section id="kato_upstream_proxies"><title>Upstream proxies are not set in DEAs added after cluster creation</title>
    <p>When DEAs are added to clusters after they have been created, upstream proxies are not automatically configured. To configure upstream proxies for these nodes, do the following:</p>
    <ol>
      <li>Connect to each DEA node using SSH</li>
      <li>Run the following commands:
      <codeblock>
kato op upstream_proxy set &lt;proxy server&gt;
service polipo restart
      </codeblock></li>
    </ol></section>
    <section id="kato_patch"><title>Kato tries to install patches on Windows nodes</title>
    <p>When <codeph>kato patch install</codeph> is run, the installer will attempt to add patches to Windows nodes. This installation will fail with the following errors:</p>
    <codeblock>stackato@fd-core:~$ kato patch install
 The authenticity of host '10.0.0.36 (10.0.0.36)' can't be established.
 ECDSA key fingerprint is 85:72:28:b6:4a:61:27:42:f7:0c:ab:8c:12:9a:06:ca.
 Are you sure you want to continue connecting (yes/no)? yes
 Warning: Permanently added '10.0.0.36' (ECDSA) to the list of known hosts.
 ssh: connect to host 10.0.0.38 port 22: Connection timed out
 Updating kato patch on 10.0.0.38...
 ssh: connect to host 10.0.0.38 port 22: Connection timed out
 ssh: connect to host 10.0.0.40 port 22: Connection timed out
 Updating kato patch on 10.0.0.40...
 ssh: connect to host 10.0.0.40 port 22: Connection timed out</codeblock></section>
    <section id="instances"><title>Windows instances created from the Images page in Horizon do not work</title>
    <p>This behavior is by design. Windows instances must be created with the <b>cf-mgmt</b> tool or through Horizon.</p></section>
    <section id="broker"><title>Error: Unable to attach broker to cluster: Received a status code
        504 Gateway Time-out</title> This procedure should be applied when the following error is
      received when installing a Microsoft SQL 2012/2014 service. <codeblock> [general] Unable to attach broker to cluster: Received a status code 504 Gateway Time-out {
          "code": 10001,
          "description": "The request to the service broker timed out: http://192.168.15.123:3000/v2/catalog",
          "error_code": "CF-ServiceBrokerApiTimeout",
          "http": {
            "uri": "http://192.168.15.123:3000/v2/catalog",
            "method": "GET"
          }
        }</codeblock>
      <p>This procedure will also repair Microsoft SQL nodes which are in a degraded status.</p>
      <ol>
        <li> SSH to the core node.</li>
        <li>Copy and paste the following code and save it to a file named
            <codeph>remove_etc_env.sh</codeph><codeblock>appliedProxyPatchMessage="#System Proxies are disabled to ensure the controller can communicate with internal service brokers"
            nodes=(`kato node list | grep -v -E "mssql|windea" | cut -d' ' -f 1`)
            for node in "${nodes[@]}"
            do :
            ssh stackato@$node /bin/bash &lt;&lt; EOF
            if ! grep -q "${appliedProxyPatchMessage}" /etc/environment; then
            sudo sed -e '/_proxy/I s/^#*/#/' -i /etc/environment &amp;&amp;
            sudo sed -i "/#HTTP_PROXY/i ${appliedProxyPatchMessage}" /etc/environment
            fi
            EOF
            
            if [[ $? != 0 ]] ; then
            echo "unable to remove existing proxy settings. exiting"
            exit 1
            fi
            done</codeblock></li>
        <li>Execute <codeblock>bash remove_etc_env.sh </codeblock></li>
        <li>If prompted to allow SSH to a new machine, select "Y".</li>
        <li>Reboot the core node. <codeblock>sudo reboot</codeblock></li>
        <li>After the core node comes back up, the issue should be resolved. You can now
          successfully add the service or the degraded state should be fixed.</li>
      </ol>
    </section>
  </body>
</topic>
