<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" >
<topic id="concept_vrb_bgj_rs">
 <title>Uninstall the Database Service</title>
 <shortdesc>Process for uninstalling the Database Service from the HPE Helion Development Platform.</shortdesc>
 <body>
  <section id="uninstall-database"> 
      
   <ol>
    <li> Log in to the Helion seed node.</li>
    <li>Source the keystone admin credentials.
     <codeblock>source ~/keystone.osrc</codeblock></li>
    <li>Remove the service from Keystone.
     <codeblock>SERVICE_SHORT_NAME="database"
SERVICE_ID=$(openstack service list | grep $SERVICE_SHORT_NAME | cut -d" " -f2)
openstack service delete $SERVICE_ID</codeblock></li>
    <li>Source the admin credentials.
     <codeblock>source ~/service.osrc</codeblock></li>
    <li>Remove the images from Glance.
     <codeblock>glance image-list | grep dbaas- | awk '{print $2}' | xargs -L 1 glance image-delete</codeblock></li>
    <li>Remove the Heat templates from Swift.
     <codeblock>swift delete DBaaS-heat-templates
swift delete dbaas-ops-console-ui-installer
swift delete dbaas-horizon-ui-installer
swift delete hdp</codeblock></li>
    <li>Find the DBaaS CSU images in the Sherpa cache. (sherpacatalog.dbaas-qcow2_2.0.0.38.csu/dbaas-qcow2_2.0.0.38.csu)
     <codeblock>swift list sherpa-cache</codeblock></li>
    <li>Delete the items from the cache.
     <codeblock>swift delete sherpa-cache &lt;ITEM&gt;</codeblock></li>
    <li>	Delete the Database as a Service (Trove) control plane instances:
     <codeblock>nova list | grep trove- | grep trove_mgmt_network | awk '{print $2}
' | xargs -L 1 nova delete</codeblock></li>
    <li>Delete the Database as a Service (Trove) networks:
     <codeblock>neutron net-delete trove_mgmt_network
neutron net-delete trove_guest_network</codeblock></li>
   </ol>
   <p>If you have Database clusters, OpenStack Horizon panel for Database Service needs to be removed manually due to a known issue. </p>
   <ol>
    <li>Log in to the Helion seed node.</li>
    <li>List the contents of Hosts:
     <codeblock>cat /etc/hosts</codeblock>
     Scan the /etc/hosts file for the 3 Horizon management nodes. Horizon management node names are similar to following:
     <codeblock>"ma-cp1-c1-m1-mgmt"
"ma-cp1-c1-m2-mgmt"
"ma-cp1-c1-m3-mgmt"</codeblock>
     Identify each of the Horizon management nodes and make a note of their IP addresses. You will use them in next step.</li>
    <li>For each Horizon management node, SSH to it and do the following:
    <ol>
     <li> Change Directory (CD) to the folder which resembles:
      <codeblock>cd /opt/stack/venv/horizon-20160226T030333Z/lib/python2.7/site-packages/openstack_dashboard/local/enabled</codeblock></li>
     <li>Remove the following files:
      <codeblock>rm databases_add_panel_group.
rm databases_add_databases_panel.
rm databases_add_database_backups_panel.
rm databases_add_database_clusters_panel.</codeblock></li>
     <li>Restart Horizon/the web server via an HLM command.
      <ol>
       <li>Log in to the Helion lifecycle manager.</li>
       <li>Run the Dashboard reconfigure playbook:
        <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts horizon-reconfigure.yml        </codeblock></li>
      </ol>
     </li>
    </ol></li>
    
    <li>Confirm the Database Service is removed from Horizon Console.</li>
   </ol>
  </section>
 </body>
</topic>
