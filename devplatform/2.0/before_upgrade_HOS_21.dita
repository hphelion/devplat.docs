<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_qp3_g5p_45">
  <title>Before Upgrading</title>
  <body>
    
    <section>
      <title>Application Lifecycle Service</title>
      <p>No additional steps are required prior to upgrading HPE Helion OpenStack.</p>
    </section>
    
    
    <section><title>Database Service</title><p>The database instances and clusters must be gracefully stopped manually prior to upgrading HPE
        Helion OpenStack.<ol id="ol_u4h_54h_45">
          <li>Download the following file that contains the upgrade scripts.<note type="tip">The
              easiest option is to download directly to the physical machine hosting the HPE Helion
              OpenStack lifecycle manager. If you can not download directly to that location,
              download the files to portable storage media and then copy the files onto the
              lifecycle manager. When downloading or copying, make sure there is enough space; the
              file sizes can be significant. </note></li>
          <li>SSH to the HPE Helion OpenStack lifecycle manager (previously known as the deployer
            node). </li>
          <li>Decompress the downloaded file
            (<codeph>DevelopmentPlatformUpgrade-2.1.tar.gz</codeph>) to a local temp
            directory.<codeblock>tar -xzf DevelopmentPlatformUpgrade-2.1.tar.gz </codeblock></li>
          <li>Source a virtual environment containing the OpenStack clients. Best practice is to use
            the built-in virtual environment on the HPE Helion OpenStack lifecycle manager, as
              follows:<ol id="ol_i4x_51w_45">
              <li>List all available virtual environments.
                <codeblock>ls /opt/stack/venv</codeblock></li>
              <li> One of the names in that list will look like:
                    <codeph>openstackclient-<i>&lt;timestamp></i></codeph>. Copy the entire name,
                including the timestamp value, for use in the next step.</li>
              <li>Source the virtual
                environment.<codeblock>source /opt/stack/venv/<i>&lt;VirtualEnvironmentName></i>/bin/activate </codeblock></li>
            </ol></li>
          <li>Execute the following command to source credentials with access to the service.
            <codeblock>source service.osrc</codeblock></li>
          <li>Disable access to the Trove API. This will stop all
              activity.<codeblock>ansible-playbook --private-key &lt;path to SSH private key> -i ./common_upgrade/inventory/inventory.py ./control_plane_upgrade/playbooks/stop-api.yml </codeblock><note
              type="tip">The SSH private key file is the one that was specified during installation
              of the database service. This same key will be used for all commands in this
              guide.</note>
          </li>
          <li>Safely stop all guest databases and
              clusters.<codeblock>ansible-playbook --extra-vars guest_private_key_file=&lt;path to SSH private key> --private-key &lt;path to SSH private key> -i ./common_upgrade/inventory/inventory.py ./guest-upgrade/playbooks/stop-guests.yml </codeblock><note
              type="important">Once the guest database instances and clusters are stopped, they will
              become inaccessible to applications that use them until they are <xref
                href="after_upgrade_HOS_21.dita#topic_rgp_g5p_45/restarted">restarted</xref>. Plan
              this outage window ahead of time and notify your users in advance.</note></li>
          <li>Safely stop the Trove services
            .<codeblock>ansible-playbook --private-key &lt;path to SSH private key> -i ./common_upgrade/inventory/inventory.py ./control_plane_upgrade/playbooks/control_plane_stop.yml </codeblock></li>
          <li>Safely stop all control plane
            instances.<codeblock> ./control_plane_upgrade/scripts/stop_control_plane_instances.bash</codeblock></li>
        </ol></p></section>
    
    <section>
      <title>HPE Helion Code Engine</title><p>No additional steps are required prior to upgrading HPE Helion OpenStack.</p>
    </section>
    <section>
      <title>Messaging Service</title><p>No additional steps are required prior to upgrading HPE Helion OpenStack.</p>
    </section>
  </body>
</topic>
