<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="cloudMessaging">
  <title>HPE Helion Development Platform 2.0: Messaging Broker Service Configuration</title>
  <body>
    <section><p>If you are installing the Messaging Broker service, add and populate the <codeph>messaging</codeph>
        and <codeph>msgaas</codeph> sections of the <codeph>clouds.yml</codeph> file as described
        below. All fields are required unless otherwise indicated.</p>
      <p>In your environment, the clouds.yaml file should be located at
          <codeph>~/.config/openstack/clouds.yaml</codeph>. If this file does not exist yet, <xref
          href="../install_cloudsyaml.dita">create it</xref>.</p>
      <p>
        <note type="important">The <codeph>messaging</codeph> section begins indented four spaces;
          it is subordinate to the <codeph>mycloud</codeph> section. The <codeph>msgaas</codeph>
          section begins indented two spaces. Look at the <xref href="fullFile.dita">complete
            file</xref> to see how all the sections fit together.</note>
      </p>
      <codeblock id="cloudmsgaas">    messaging:
      deployer_cloud: msgaas
      deployer_ntp_servers: <i>&lt;NTP servers></i>
      deployer_dns_servers: <i>&lt;DNS servers></i>
      deployer_flavor: 3 ##This value must be set to 3##
      ##### These settings are optional. If you are not providing a value for them, delete these lines entirely. Do not leave blank.
      deployer_key: msgaas-key
      deployer_name: msgaas_deployer_01   
      deployer_security_group: default
      deployer_image: hlinux_msgaas
      deployer_ext_net_id: ext-net
      deployer_cname: <i>&lt;CN name used to generate the certificate file></i>
      #####          
  msgaas:
    region_name: region1
    insecure: True
    auth:
      auth_url: <i>&lt;http://##.##.##.##:####/v3></i>
      project_name: msgaas
      username: msgaas
      password: password
      project_domain_name: default
      user_domain_name: default              </codeblock></section><section><title>Configuration Parameters Required by the HDPI Installer</title><dl>
        <dlentry>
          <dt>deployer_cloud</dt>
          <dd>Value must be <codeph>msgaas</codeph></dd>
          <dd>The cloud identified in the clouds.yaml file where the deployer will be created. Note
            that while the deployer creation must be performed by an admin, the deployer itself may
            be owned by someone else. </dd>
        </dlentry>
        <dlentry>
          <dt>deployer_ntp_servers</dt>
          <dd>NTP servers, provided as a list. Can be the same as the one used by HPE Helion
            OpenStack as defined in <codeph>~/helion/my_cloud/definition/cloudConfig.yml</codeph>
          </dd>
        </dlentry>
        <dlentry>
          <dt>deployer_dns_servers</dt>
          <dd>DNS servers, provided as a list. Can be the same as the one used by HPE Helion
            OpenStack as defined in <codeph>~/helion/my_cloud/definition/cloudConfig.yml</codeph>
          </dd>
        </dlentry>
        <dlentry>
          <dt>deployer_flavor</dt>
          <dd>The flavor ID to use for the deployer instance. <note type="warning">The default value
              is 4 (Large) but you <b>must</b> change this value to 3 (Medium) or installation
              cannot complete successfully. This is a known issue.</note></dd>
        </dlentry>
      </dl></section><section><title>Optional Configuration Parameters for the HDPI Installer</title><p>These settings are optional. Default values are provided, but if you are not using these
        settings, <b>delete these lines entirely</b>. Do not leave the values blank.</p><dl>
        <dlentry>
          <dt>deployer_key (optional)</dt>
          <dd>The keypair to use to SSH into the deployer instance. Default value:
              <i>project_name</i>. If the keypair does not exist in Nova, it would get created using
            the default user SSH public key.</dd>
        </dlentry>
        <dlentry>
          <dt>deployer_name (optional)</dt>
          <dd>The name of the deployer instance. </dd>
          <dd>Default value: <i>NameOfService</i>_deployer_<i>VersionNumber</i></dd>
        </dlentry>
        <dlentry>
          <dt>deployer_security_group (optional)</dt>
          <dd>The name of the security group for the deployer. </dd>
          <dd>Default value: <codeph>default</codeph></dd>
        </dlentry>
        <dlentry>
          <dt>deployer_image (optional)</dt>
          <dd>The image to use for the deployer. It will attempt to find an image with the prefix
              <i>helionci</i> or <i>msgaas</i> and containing the word <i>hlinux</i>.</dd>
        </dlentry>
        <dlentry>
          <dt>deployer_ext_net_id (optional)</dt>
          <dd>The external network name. Default value: <codeph>ext-net </codeph><note>While this
              must be specified in the configuration file (it cannot be left blank) the value is not
              currently read. Only the default value is used.</note></dd>
        </dlentry>
        <dlentry>
          <dt>deployer_cname (optional)</dt>
          <dd>CN name used to generate the certificate file.</dd>
        </dlentry></dl>
      </section>
      <section><title>Cloud Configuration Parameters for the Messaging Installer</title>
        <dl>
        <dlentry>
          <dt>region_name</dt>
          <dd>The region name to use. The default value is <codeph>region1</codeph></dd>
        </dlentry>
        <dlentry>
          <dt>insecure (optional)</dt>
          <dd>This flag will automatically accept an internally signed cert without prompting the
            user when connecting to the HPE Helion OpenStack services. Default value: True</dd>
        </dlentry>
        <dlentry>
          <dt>auth_url</dt>
          <dd>This URL can be found on the installer node by entering the following commands:
            <codeblock>stack@helion-ccp1-controller-m1-mgmt:~$ source keystone.osrc
stack@helion-ccp1-controller-m1-mgmt:~$ openstack endpoint list|grep -i keystone</codeblock>
            This will return results similar to the following: 
            <codeblock>| 1e796278bd68472ab3ab6e8f1d585e2a | region1 | keystone     | identity      | True    | admin     | http://10.13.111.145:35357/v2.0                 |
| 5bdc0832e017443eac8e4e49cfd39bd4 | region1 | keystone     | identity      | True    | internal  | http://10.13.111.145:5000/v2.0                  |
| 7670634c106b48af9d9329a0fb2b76c0 | region1 | keystone     | identity      | True    | public    | https://10.13.120.75:5000/v2.0                  |</codeblock>
            </dd>
        </dlentry>
        <dlentry>
          <dt>project_name</dt>
          <dd>This project will be created by the HDPI service installation process. This project
            must NOT exist prior to installing the Messaging Broker Service.</dd>
        </dlentry>
        <dlentry>
          <dt>username</dt>
          <dd>This user will be created by the HDPI service installation process. This user must NOT
            exist prior to installing the Messaging Broker Service. The username must be
              <b>msgaas</b>.</dd>
        </dlentry>
        <dlentry>
          <dt>password</dt>
          <dd>The Password for the same account with installation privileges (administrator
            role).</dd>
        </dlentry>
        <dlentry>
          <dt>project_domain_name: default</dt>
          <dd>Unless changes are required for your environment, accept the default value.</dd>
        </dlentry>
        <dlentry>
          <dt>user_domain_name: default </dt>
          <dd>Unless changes are required for your environment, accept the default value.</dd>
        </dlentry>
      </dl>
    </section>
  </body>
</topic>
